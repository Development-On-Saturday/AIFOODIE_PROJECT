{% extends 'base2.html' %}
{% load static %}

{% block title %}
    Search
{% endblock %}
    

{% block extra-style %}
<link rel="stylesheet" href="{% static 'css/style_c.css' %}">
<script src="{% static 'javascripts/main_c.js' %}" defer></script>
{% endblock %}


{% block content %}

<!-- Food Search Map -->

<section id="classifier" class="section">
    <div class="container">
        <h1>
        </br>Let's Search Food Place!
        </h1>        
        <h2>ì£¼ë³€ ìŒì‹ì ğŸš</h2>

        <div class="place">
            <div id="map" style="width:80%; height:700px; margin:50px auto 100px; z-index: 0"></div>
        </div>
        
        <a href="{% url 'foods:classifier' %}"><button class="btn_upload">
            ğŸ‘‹ë˜ëŒì•„ê°€ê¸°
        </button></a>

    </div>
</section>

<!-- Food Search Map -->
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=d9b233b6fb70f3927bd1aa1ee26fdcb7&libraries=services,clusterer,drawing"></script>


<script>
    // ë§ˆì»¤ë¥¼ í´ë¦­í•˜ë©´ ì¥ì†Œëª…ì„ í‘œì¶œí•  ì¸í¬ìœˆë„ìš° ì…ë‹ˆë‹¤
    var infowindow = new kakao.maps.InfoWindow({zIndex:1});
    
    var mapContainer = document.getElementById('map'), // ì§€ë„ë¥¼ í‘œì‹œí•  div 
        mapOption = {
            center: new kakao.maps.LatLng(37.566826, 126.9786567), // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ
            level: 1 // ì§€ë„ì˜ í™•ëŒ€ ë ˆë²¨
        };  
    
    // ì§€ë„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤    
    var map = new kakao.maps.Map(mapContainer, mapOption); 
    
    // ì¥ì†Œ ê²€ìƒ‰ ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
    var ps = new kakao.maps.services.Places(); 
    
    // í‚¤ì›Œë“œë¡œ ì¥ì†Œë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤
    ps.keywordSearch("{{search}}", placesSearchCB); 
    
    // í‚¤ì›Œë“œ ê²€ìƒ‰ ì™„ë£Œ ì‹œ í˜¸ì¶œë˜ëŠ” ì½œë°±í•¨ìˆ˜ ì…ë‹ˆë‹¤
    function placesSearchCB (data, status, pagination) {
        if (status === kakao.maps.services.Status.OK) {
    
            // ê²€ìƒ‰ëœ ì¥ì†Œ ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì§€ë„ ë²”ìœ„ë¥¼ ì¬ì„¤ì •í•˜ê¸°ìœ„í•´
            // LatLngBounds ê°ì²´ì— ì¢Œí‘œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤
            var bounds = new kakao.maps.LatLngBounds();
    
            for (var i=0; i<data.length; i++) {
                displayMarker(data[i]);    
                bounds.extend(new kakao.maps.LatLng(data[i].y, data[i].x));
            }       
    
            // ê²€ìƒ‰ëœ ì¥ì†Œ ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì§€ë„ ë²”ìœ„ë¥¼ ì¬ì„¤ì •í•©ë‹ˆë‹¤
            map.setBounds(bounds);
        } 
    }
    
    // ì§€ë„ì— ë§ˆì»¤ë¥¼ í‘œì‹œí•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤
    function displayMarker(place) {
        
        // ë§ˆì»¤ë¥¼ ìƒì„±í•˜ê³  ì§€ë„ì— í‘œì‹œí•©ë‹ˆë‹¤
        var marker = new kakao.maps.Marker({
            map: map,
            position: new kakao.maps.LatLng(place.y, place.x) 
        });
    
        // ë§ˆì»¤ì— í´ë¦­ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤
        kakao.maps.event.addListener(marker, 'click', function() {
            // ë§ˆì»¤ë¥¼ í´ë¦­í•˜ë©´ ì¥ì†Œëª…ì´ ì¸í¬ìœˆë„ìš°ì— í‘œì¶œë©ë‹ˆë‹¤
            infowindow.setContent('<div style="padding:5px;font-size:12px;">' + place.place_name + '</div>');
            infowindow.open(map, marker);
        });
    }
</script>

{% endblock %}